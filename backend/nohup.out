
2025-07-27 01:55:45.489  INFO 15882 --- [           main] com.fbadsautomation.Application          : Starting Application v0.0.1-SNAPSHOT using Java 17.0.15 on Chanchan with PID 15882 (/home/linhnh/ads-creative-content/backend/target/facebook-ads-automation-0.0.1-SNAPSHOT.jar started by linhnh in /home/linhnh/ads-creative-content/backend)
2025-07-27 01:55:45.494 DEBUG 15882 --- [           main] com.fbadsautomation.Application          : Running with Spring Boot v2.7.8, Spring v5.3.25
2025-07-27 01:55:45.495  INFO 15882 --- [           main] com.fbadsautomation.Application          : No active profile set, falling back to 1 default profile: "default"
2025-07-27 01:55:47.318  INFO 15882 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-07-27 01:55:47.319  INFO 15882 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-07-27 01:55:47.627  INFO 15882 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 289 ms. Found 4 JPA repository interfaces.
2025-07-27 01:55:48.679  INFO 15882 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-07-27 01:55:48.682  INFO 15882 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-07-27 01:55:48.726  INFO 15882 --- [           main] .RepositoryConfigurationExtensionSupport : Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.fbadsautomation.repository.UserRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-07-27 01:55:48.727  INFO 15882 --- [           main] .RepositoryConfigurationExtensionSupport : Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.fbadsautomation.repository.AdRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-07-27 01:55:48.729  INFO 15882 --- [           main] .RepositoryConfigurationExtensionSupport : Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.fbadsautomation.repository.CampaignRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-07-27 01:55:48.729  INFO 15882 --- [           main] .RepositoryConfigurationExtensionSupport : Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.fbadsautomation.repository.AdContentRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-07-27 01:55:48.729  INFO 15882 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 25 ms. Found 0 Redis repository interfaces.
2025-07-27 01:55:49.272  INFO 15882 --- [           main] o.s.cloud.context.scope.GenericScope     : BeanFactory id=911088c7-7bc2-3e53-8ad3-baad8fe29f32
2025-07-27 01:55:50.832  INFO 15882 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
2025-07-27 01:55:50.853  INFO 15882 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-07-27 01:55:50.853  INFO 15882 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.71]
2025-07-27 01:55:50.991  INFO 15882 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-07-27 01:55:50.992  INFO 15882 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 5371 ms
2025-07-27 01:55:51.483  INFO 15882 --- [           main] com.zaxxer.hikari.HikariDataSource       : FBAdsAutomationPool - Starting...
2025-07-27 01:55:52.147  INFO 15882 --- [           main] com.zaxxer.hikari.pool.HikariPool        : FBAdsAutomationPool - Added connection org.postgresql.jdbc.PgConnection@3b1bb3ab
2025-07-27 01:55:52.154  INFO 15882 --- [           main] com.zaxxer.hikari.HikariDataSource       : FBAdsAutomationPool - Start completed.
2025-07-27 01:55:52.154  INFO 15882 --- [           main] c.fbadsautomation.config.DatabaseConfig  : ✅ Configured HikariCP connection pool:
2025-07-27 01:55:52.155  INFO 15882 --- [           main] c.fbadsautomation.config.DatabaseConfig  :    - Pool Name: FBAdsAutomationPool
2025-07-27 01:55:52.155  INFO 15882 --- [           main] c.fbadsautomation.config.DatabaseConfig  :    - Maximum Pool Size: 20
2025-07-27 01:55:52.156  INFO 15882 --- [           main] c.fbadsautomation.config.DatabaseConfig  :    - Minimum Idle: 5
2025-07-27 01:55:52.156  INFO 15882 --- [           main] c.fbadsautomation.config.DatabaseConfig  :    - Connection Timeout: 30000ms
2025-07-27 01:55:52.156  INFO 15882 --- [           main] c.fbadsautomation.config.DatabaseConfig  :    - Idle Timeout: 600000ms
2025-07-27 01:55:52.156  INFO 15882 --- [           main] c.fbadsautomation.config.DatabaseConfig  :    - Max Lifetime: 1800000ms
2025-07-27 01:55:52.157  INFO 15882 --- [           main] c.fbadsautomation.config.DatabaseConfig  :    - Leak Detection Threshold: 60000ms
2025-07-27 01:55:52.826  INFO 15882 --- [           main] o.f.c.internal.license.VersionPrinter    : Flyway Community Edition 8.5.13 by Redgate
2025-07-27 01:55:52.826  INFO 15882 --- [           main] o.f.c.internal.license.VersionPrinter    : See what's new here: https://flywaydb.org/documentation/learnmore/releaseNotes#8.5.13
2025-07-27 01:55:52.826  INFO 15882 --- [           main] o.f.c.internal.license.VersionPrinter    : 
2025-07-27 01:55:52.888  INFO 15882 --- [           main] o.f.c.i.database.base.BaseDatabaseType   : Database: jdbc:postgresql://localhost:5432/fbadsautomation (PostgreSQL 14.18)
2025-07-27 01:55:52.994  INFO 15882 --- [           main] o.f.core.internal.command.DbValidate     : Successfully validated 8 migrations (execution time 00:00.047s)
2025-07-27 01:55:53.013  INFO 15882 --- [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "public": 8
2025-07-27 01:55:53.015  INFO 15882 --- [           main] o.f.core.internal.command.DbMigrate      : Schema "public" is up to date. No migration necessary.
2025-07-27 01:55:53.079  INFO 15882 --- [           main] c.fbadsautomation.config.DatabaseConfig  : ✅ Configured Hibernate EntityManagerFactory with performance optimizations
2025-07-27 01:55:53.050  INFO 15882 --- [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-07-27 01:55:54.079 DEBUG 15882 --- [           main] c.f.security.JwtAuthenticationFilter     : Filter 'jwtAuthenticationFilter' configured for use
2025-07-27 01:55:54.192  INFO 15882 --- [           main] c.fbadsautomation.ai.AnthropicProvider   : Using Anthropic API URL: https://api.anthropic.com/v1/messages
2025-07-27 01:55:54.200  INFO 15882 --- [           main] com.fbadsautomation.ai.FalAiProvider     : Using Fal.ai API URL: https://fal.run/fal-ai/fast-sdxl
2025-07-27 01:55:54.209  INFO 15882 --- [           main] com.fbadsautomation.ai.GeminiProvider    : Using Gemini API URL: https://generativelanguage.googleapis.com/v1/models/gemini-1.5-pro:generateContent
2025-07-27 01:55:54.216  INFO 15882 --- [           main] com.fbadsautomation.ai.OpenAIProvider    : Using OpenAI Text API URL: https://api.openai.com/v1/chat/completions
2025-07-27 01:55:54.216  INFO 15882 --- [           main] com.fbadsautomation.ai.OpenAIProvider    : Using OpenAI Image API URL: https://api.openai.com/v1/images/generations
2025-07-27 01:55:54.225  INFO 15882 --- [           main] c.f.ai.StableDiffusionProvider           : Using Stable Diffusion Image API URL: https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-xl-base-1.0
2025-07-27 01:55:54.226  INFO 15882 --- [           main] c.f.ai.StableDiffusionProvider           : Image save directory ensured at: uploads/images
2025-07-27 01:55:54.234  INFO 15882 --- [           main] c.f.ai.HuggingFaceProvider               : Using Hugging Face Text API URL: https://api-inference.huggingface.co/models/PeterBrendan/AdsGPT2
2025-07-27 01:55:54.234  INFO 15882 --- [           main] c.f.ai.HuggingFaceProvider               : Using Hugging Face Image API URL: https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-xl-base-1.0
2025-07-27 01:55:54.234  INFO 15882 --- [           main] c.f.ai.HuggingFaceProvider               : Image save directory ensured at: src/main/resources/static/generated_images
2025-07-27 01:55:54.946  INFO 15882 --- [           main] c.f.service.AIProviderService            : ✅ Loaded 6 AI providers: [gemini, openai, fal.ai, anthropic_claude, stable_diffusion, hugging_face]
2025-07-27 01:55:54.947  INFO 15882 --- [           main] c.f.service.AIProviderService            : ✅ Initialized fallback chains: {gemini=[openai, anthropic, huggingface], openai=[gemini, anthropic, huggingface], stable-diffusion=[fal-ai], fal-ai=[stable-diffusion], anthropic=[openai, gemini, huggingface], huggingface=[openai, gemini, anthropic]}
2025-07-27 01:55:56.298  WARN 15882 --- [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-07-27 01:55:56.433  INFO 15882 --- [           main] c.fbadsautomation.config.DatabaseConfig  : ✅ Configured JPA Transaction Manager with 30s timeout
2025-07-27 01:55:56.910  INFO 15882 --- [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@72a3462f, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@4ffa7041, org.springframework.security.web.context.SecurityContextPersistenceFilter@28fa541, org.springframework.security.web.header.HeaderWriterFilter@1de85972, org.springframework.web.filter.CorsFilter@632c3f55, org.springframework.security.web.authentication.logout.LogoutFilter@19d27c27, org.springframework.security.oauth2.client.web.OAuth2AuthorizationRequestRedirectFilter@5d37aa0f, org.springframework.security.oauth2.client.web.OAuth2LoginAuthenticationFilter@6076c66, com.fbadsautomation.security.JwtAuthenticationFilter@1b17d8ab, org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter@43d3995f, org.springframework.security.web.authentication.ui.DefaultLogoutPageGeneratingFilter@56b05bd7, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@4aab7195, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@52657d5f, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@3e4afd10, org.springframework.security.web.session.SessionManagementFilter@57b1ec84, org.springframework.security.web.access.ExceptionTranslationFilter@2c2a7d53, org.springframework.security.web.access.intercept.FilterSecurityInterceptor@5c4714ef]
2025-07-27 01:56:00.475  INFO 15882 --- [           main] o.s.b.a.e.web.EndpointLinksResolver      : Exposing 3 endpoint(s) beneath base path '/actuator'
2025-07-27 01:56:00.590  INFO 15882 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
2025-07-27 01:56:00.626  INFO 15882 --- [           main] com.fbadsautomation.Application          : Started Application in 18.812 seconds (JVM running for 20.071)
2025-07-27 01:56:12.306  INFO 15882 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-07-27 01:56:12.307  INFO 15882 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-07-27 01:56:12.310  INFO 15882 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 3 ms
2025-07-27 01:56:46.287 DEBUG 15882 --- [nio-8080-exec-1] c.f.security.JwtAuthenticationFilter     : Set authentication for user ID: 2
2025-07-27 01:56:46.547  INFO 15882 --- [nio-8080-exec-1] c.f.controller.AdController              : Generating ad content for user: 2
2025-07-27 01:56:46.548  INFO 15882 --- [nio-8080-exec-1] c.f.controller.AdController              : Creating preview for user: 2
2025-07-27 01:56:46.555  INFO 15882 --- [nio-8080-exec-1] com.fbadsautomation.service.AdService    : Generating preview content for ad: Quảng cáo số 2
2025-07-27 01:56:46.555  INFO 15882 --- [nio-8080-exec-1] c.f.service.AIContentService             : Generating content for ad: null
2025-07-27 01:56:46.556  INFO 15882 --- [nio-8080-exec-1] c.f.integration.ai.AIContentServiceImpl  : Using only original prompt as no ad links or extracted content provided
2025-07-27 01:56:46.556  INFO 15882 --- [nio-8080-exec-1] c.f.integration.ai.AIContentServiceImpl  : Final prompt built: Quảng cáo về ba lô Mark Ryden

Lưu ý: Chỉ sử dụng một trong các Call to Action sau cho quảng cáo: Shop Now, Learn More, Sign Up, Download, Contact Us, Apply Now, Book Now, Get Offer, Message Page, Subscribe. Không tạo CTA khác.
2025-07-27 01:56:46.557  INFO 15882 --- [nio-8080-exec-1] c.f.integration.ai.AIContentServiceImpl  : Generating 1 text variations using enhanced reliability features
2025-07-27 01:56:47.030 ERROR 15882 --- [nio-8080-exec-1] c.f.service.AIContentCacheService        : Failed to retrieve cached AI content: Unable to connect to Redis; nested exception is io.lettuce.core.RedisConnectionException: Unable to connect to localhost/<unresolved>:6379

org.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is io.lettuce.core.RedisConnectionException: Unable to connect to localhost/<unresolved>:6379
	
Caused by: io.lettuce.core.RedisConnectionException: Unable to connect to localhost/<unresolved>:6379

Caused by: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:6379
Caused by: java.net.ConnectException: Connection refused
	

2025-07-27 01:56:47.055 ERROR 15882 --- [nio-8080-exec-1] c.f.service.AIContentCacheService        : Failed to record provider usage stats: Unable to connect to Redis; nested exception is io.lettuce.core.RedisConnectionException: Unable to connect to localhost/<unresolved>:6379

2025-07-27 01:56:47.580 ERROR 15882 --- [nio-8080-exec-1] c.f.service.AIContentCacheService        : Failed to record provider usage stats: Unable to connect to Redis; nested exception is io.lettuce.core.RedisConnectionException: Unable to connect to localhost/<unresolved>:6379

2025-07-27 01:56:48.607 ERROR 15882 --- [nio-8080-exec-1] c.f.service.AIProviderService            : Provider 'openai' failed after retries: Cannot invoke "com.fbadsautomation.model.FacebookCTA.name()" because "callToAction" is null
2025-07-27 01:56:48.608  WARN 15882 --- [nio-8080-exec-1] c.f.service.AIProviderService            : Primary provider 'openai' failed, trying fallback: 'gemini'
2025-07-27 01:56:48.608 DEBUG 15882 --- [nio-8080-exec-1] com.fbadsautomation.ai.GeminiProvider    : Calling Gemini API at: https://generativelanguage.googleapis.com/v1/models/gemini-1.5-pro:generateContent?key=AIzaSyCi0DZXt45G7cXmLbXlopQJLG5D252VI5Q
2025-07-27 01:56:50.366 ERROR 15882 --- [nio-8080-exec-1] com.fbadsautomation.ai.GeminiProvider    : Error calling Gemini API: 400 Bad Request: "{<EOL>  "error": {<EOL>    "code": 400,<EOL>    "message": "Invalid JSON payload received. Unknown name \"responseMimeType\" at 'generation_config': Cannot find field.",<EOL>    "status": "INVALID_ARGUMENT",<EOL>    "details": [<EOL>      {<EOL>        "@type": "type.googleapis.com/google.rpc.BadRequest",<EOL>        "fieldViolations": [<EOL>          {<EOL>            "field": "generation_config",<EOL>            "description": "Invalid JSON payload received. Unknown name \"responseMimeType\" at 'generation_config': Cannot find field."<EOL>          }<EOL>        ]<EOL>      }<EOL>    ]<EOL>  }<EOL>}<EOL>"

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 Bad Request: "{<EOL>  "error": {<EOL>    "code": 400,<EOL>    "message": "Invalid JSON payload received. Unknown name \"responseMimeType\" at 'generation_config': Cannot find field.",<EOL>    "status": "INVALID_ARGUMENT",<EOL>    "details": [<EOL>      {<EOL>        "@type": "type.googleapis.com/google.rpc.BadRequest",<EOL>        "fieldViolations": [<EOL>          {<EOL>            "field": "generation_config",<EOL>            "description": "Invalid JSON payload received. Unknown name \"responseMimeType\" at 'generation_config': Cannot find field."<EOL>          }<EOL>        ]<EOL>      }<EOL>    ]<EOL>  }<EOL>}<EOL>"
	
2025-07-27 01:56:50.367  WARN 15882 --- [nio-8080-exec-1] com.fbadsautomation.ai.GeminiProvider    : Generated/Parsed only 0 valid ad contents from Gemini, filling remaining 1 with mock data.
2025-07-27 01:56:50.382 ERROR 15882 --- [nio-8080-exec-1] c.f.service.AIContentCacheService        : Failed to record provider usage stats: Unable to connect to Redis; nested exception is io.lettuce.core.RedisConnectionException: Unable to connect to localhost/<unresolved>:6379

2025-07-27 01:56:50.383  INFO 15882 --- [nio-8080-exec-1] c.f.service.AIProviderService            : Fallback provider 'gemini' succeeded
2025-07-27 01:56:50.429 ERROR 15882 --- [nio-8080-exec-1] c.f.service.AIContentCacheService        : Failed to cache AI content: Unable to connect to Redis; nested exception is io.lettuce.core.RedisConnectionException: Unable to connect to localhost/<unresolved>:6379

